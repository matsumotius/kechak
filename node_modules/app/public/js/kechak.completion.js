$(function(){
  var completion = kechak.completion = {};
  completion.modes = ['web', 'img', 'mov'];
  completion.mode  = completion.modes[1];

  $('.input-completion-mode').css('width', (100/completion.modes.length) + '%');
  $('.input-completion-mode').hover(function(e){ 
    $(this).css('background-color', '#ff0');
  },function(e){
    $(this).css('background-color', '#fff');
  });

  completion.update = function(text){
    completion[completion.mode](text);
  };
  completion.web = function(text){
    $('#input-completion').text(text+"[WEB]");
  };
  completion.img = function(text){
    $('#input-completion').text(text);
    kechak.socket.emit('complement/tiqav', { text : text });
  };
  completion.map = function(text){
    $('#input-completion').text(text);
  };
  completion.mov = function(text){
    $('#input-completion').text(text);
  };
  $('#input-completion .completion-img').live('click', function(e){
    var image_id = $(this).attr('data-id');
    kechak.input.append('[tiqav:'+image_id+']');
  });
  kechak.socket.on('complement/tiqav', function(list){
    var images     = $('<div/>').css({ 'width' : '9999px' });
    var tiqav_host = 'http://tiqav.com/';
    $.each(list, function(index, image){
      var imageTag = $('<img/>').css({
                       'height' : '180px'
                     }).attr({
                       'src'  : tiqav_host + image.id + '.' + image.ext
                     });
      var imageBox = $('<div/>').css({
                       'float'   : 'left',
                       'padding' : '0px 3px 0px 3px'
                     }).attr({
                       'data-id' : image.id,
                       'class'   : 'completion-img',
                     }).append(imageTag);
      images.append(imageBox);
    });
    $('#input-completion').html(images);
  });
});
