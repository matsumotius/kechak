var EventEmitter = require('events').EventEmitter;
var request      = require('request');
var jsonUtil     = require('app/utils/json');

var tiqavService = module.exports = {
  search : function(text) {
    var ev     = new EventEmitter();
    var params = {
      method  : 'GET',
      uri     : 'http://api.tiqav.com/search.json?q=' + text,
      headers : { Accept : 'application/json' }
    };
    request.get(params, function(error, response, body){
      if(error){
        ev.emit('error');
      } else {
        ev.emit('end', jsonUtil.parse(response.body));
      }
    });
    return ev;
  }
};
